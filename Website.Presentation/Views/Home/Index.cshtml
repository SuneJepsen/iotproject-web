
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/_Layout.cshtml";
}

<h2>Index</h2>

<div id="myDiv"></div>

<script>
    $(document).ready(function () {
        // do your magic here
        console.log("ready!");
        function rand() {
            return Math.random();
        }

        var time = new Date();

        var data = [{
            x: [time],
            y: [rand],
            mode: 'lines',
            line: { color: '#80CAF6' }
        }]

        var layout = {
            xaxis: {
                type: 'date',
                range: [time,time],
                rangeslider: { range: [time, time] },
            }
        };

        Plotly.plot('myDiv', data, layout);

        var cnt = 0;
        var startingTime = time

        var interval = setInterval(function () {

            var time = new Date();

            var update = {
                x: [[time]],
                y: [[rand()]]
            }

            var olderTime = time.setMinutes(time.getMinutes() - 1);
            var futureTime = time.setMinutes(time.getMinutes() + 1);

            var minuteView = {
                xaxis: {
                    type: 'date',
                    range: [olderTime, futureTime],
                    rangeslider: { range: [startingTime, futureTime] },
                }
            };

            Plotly.relayout('myDiv', minuteView);
            Plotly.extendTraces('myDiv', update, [0])

            if (cnt === 100) clearInterval(interval);
        }, 1000);

        //Plotly.d3.csv("https://raw.githubusercontent.com/plotly/datasets/master/finance-charts-apple.csv", function(err, rows){

        //    function unpack(rows, key) {
        //        return rows.map(function(row) { return row[key]; });
        //    }

  
        //    var trace1 = {
        //        type: "scatter",
        //        mode: "lines",
        //        name: 'AAPL High',
        //        x: unpack(rows, 'Date'),
        //        y: unpack(rows, 'AAPL.High'),
        //        line: {color: '#17BECF'}
        //    }

        //    var trace2 = {
        //        type: "scatter",
        //        mode: "lines",
        //        name: 'AAPL Low',
        //        x: unpack(rows, 'Date'),
        //        y: unpack(rows, 'AAPL.Low'),
        //        line: {color: '#7F7F7F'}
        //    }

        //    var data = [trace1,trace2];
    
        //    var layout = {
        //        title: 'Time Series with Rangeslider', 
        //        xaxis: {
        //            autorange: true, 
        //            range: ['2015-02-17', '2017-02-16'], 
        //            rangeselector: {buttons: [
        //                {
        //                    count: 1, 
        //                    label: '1m', 
        //                    step: 'month', 
        //                    stepmode: 'backward'
        //                }, 
        //                {
        //                    count: 6, 
        //                    label: '6m', 
        //                    step: 'month', 
        //                    stepmode: 'backward'
        //                }, 
        //                {step: 'all'}
        //            ]}, 
        //            rangeslider: {range: ['2015-02-17', '2017-02-16']}, 
        //            type: 'date'
        //        }, 
        //        yaxis: {
        //            autorange: true, 
        //            range: [86.8700008333, 138.870004167], 
        //            type: 'linear'
        //        }
        //    };

        //    Plotly.newPlot('myDiv', data, layout);
        //})
    });
</script>